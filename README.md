# AITuber 手作りキット v2.2 - 機能分割・CustomTkinter版

## システム概要

TkinterおよびCustomTkinterをベースとした、AIキャラクター（AITuber）を動作させるための機能分割型アプリケーションです。
各機能は独立したウィンドウとして起動でき、設定管理、キャラクター管理、AIチャット、AI劇場、YouTube Live連携、デバッグなどの機能を提供します。
音声合成エンジンとして、Google AI Studio 新音声合成、Avis Speech Engine、VOICEVOX Engine、システムTTSの4種類に対応し、フォールバック機能も備えています。

### 主な機能 (各ウィンドウ)
- **ランチャー (`launcher.py`)**: 各機能ウィンドウを起動します。アプリケーションの起点となります。
- **設定画面 (`settings_window.py`)**:
    - APIキー設定 (Google AI Studio, YouTube)
    - テキスト生成モデル選択 (Gemini, Local LLM)
    - デフォルト音声エンジン、音声出力デバイス選択
    - フォールバック設定、その他システム設定
- **キャラクター管理 (`character_management_window.py`)**:
    - 複数キャラクターの作成・編集・複製・削除・エクスポート・インポート
    - 各キャラクターの性格、声（エンジン、モデル、速度等）、応答スタイル設定
    - キャラクターテンプレートの利用
- **AIチャット (`ai_chat_window.py`)**:
    - AIキャラクターとの対話機能
    - 会話履歴の記録・表示・管理 (CSVベース)
    - ユーザー発話の音声再生オプション
- **AI劇場 (`ai_theater_window.py`)**:
    - CSV形式の台本を読み込み、キャラクター同士の掛け合いを自動生成・再生
    - 台詞ごとの音声生成、連続再生、行編集機能
- **YouTube Live連携 (`youtube_live_window.py`)**:
    - YouTube Liveのチャットコメントを取得し、AIキャラクターが応答
    - 配信制御、関連ログ表示
- **デバッグ画面 (`debug_window.py`)**:
    - 各音声エンジンの個別テスト、全エンジン比較
    - API接続テスト (Google AI Studio, YouTube API, ローカル音声エンジン)
    - AI対話テスト（特定キャラクターでの応答生成と音声再生）
- **ヘルプ画面 (`help_window.py`)**:
    - 各音声エンジンのセットアップガイド、トラブルシューティング情報

## 💰 コスト構造と音声エンジン

### ✅ 無料で利用可能なエンジン
- **Google AI Studio 新音声合成**: Google AI Studioの無料枠の範囲内で利用可能 (APIキー設定が必要)。高品質でリアルタイム性に優れます。
- **Avis Speech Engine**: ローカル実行型。高品質な日本語音声。別途エンジンを起動する必要があります。
- **VOICEVOX Engine**: ローカル実行型。多数のキャラクター音声が利用可能。別途エンジンを起動する必要があります。
- **システムTTS**: OS標準の音声合成機能。追加インストール不要でオフラインでも利用可能ですが、品質は上記専用エンジンに劣る場合があります。

### ⚙️ 音声エンジンのフォールバック
本システムは、優先度の高い音声エンジンが利用できない場合に、自動的に次の優先度のエンジンに切り替わるフォールバック機能を備えています。デフォルトの優先順位は以下の通りです:
1. Google AI Studio 新音声合成
2. Avis Speech Engine
3. VOICEVOX Engine
4. システムTTS

## 📋 事前準備チェックリスト

### Step 1: Python環境構築
- **Python 3.9以上**を推奨します（一部ライブラリが要求するため）。
- 必要なライブラリは `requirements.txt` に記載されています。以下のコマンドでインストールしてください。
  ```bash
  pip install -r requirements.txt
  ```
  主要なライブラリは以下の通りです:
  - `customtkinter`: モダンなGUIフレームワーク
  - `Pillow`: 画像処理ライブラリ (CustomTkinterの依存関係)
  - `google-generativeai`: Google AI Studio API用 (文章生成、新音声合成)
  - `requests`: HTTP通信用 (YouTube API等)
  - `aiohttp`: 非同期HTTP通信用 (ローカル音声エンジンAPI連携等)

### Step 2: APIキー取得
- **Google AI Studio APIキー (必須)**:
    1. [Google AI Studio](https://aistudio.google.com/)にアクセスし、APIキーを取得します。
    2. このAPIキーは、AIの文章生成とGoogle AI Studio新音声合成の両方に使用されます。
    3. 取得したAPIキーは、本アプリケーションの「設定画面」で設定します。
- **YouTube Data API v3キー (YouTube Live連携時必須)**:
    1. [Google Cloud Console](https://console.cloud.google.com/)でプロジェクトを作成または選択し、YouTube Data API v3を有効化してAPIキーを取得します。
    2. 取得したAPIキーは、本アプリケーションの「設定画面」で設定します。

### Step 3: ローカル音声エンジンのセットアップ (任意)
- **Avis Speech Engine**:
    - 公式サイト等からダウンロードし、エンジンを起動しておきます (デフォルトポート: 10101)。
    - 詳細は「ヘルプ画面」のガイドを参照してください。
- **VOICEVOX Engine**:
    - 公式サイト等からダウンロードし、エンジンを起動しておきます (デフォルトポート: 50021)。
    - 詳細は「ヘルプ画面」のガイドを参照してください。

## 🚀 起動方法
1. 上記の事前準備を完了します。
2. リポジトリのルートディレクトリで以下のコマンドを実行します。
   ```bash
   python main.py
   ```
3. ランチャーウィンドウが表示されるので、利用したい機能のボタンをクリックして各画面を開きます。

## 🛠️ 各機能の使い方 (概要)

- **設定画面**: まずAPIキーやデフォルト音声エンジンなどを設定し、「設定を保存」してください。
- **キャラクター管理**: 新しいキャラクターを作成したり、既存のキャラクターを編集します。声のテストもここで行えます。
- **AIチャット**: キャラクターを選択し、自由に会話を楽しめます。会話履歴はCSVファイルとして保存されます。
- **AI劇場**: CSV形式で台本を作成・読み込み、キャラクターたちの掛け合いを自動生成・再生できます。
- **YouTube Live連携**: ライブIDとキャラクターを設定し、配信を開始すると、チャットコメントにキャラクターが応答します。
- **デバッグ画面**: 各音声エンジンやAPIの接続テスト、AIの応答テストなどが行えます。
- **ヘルプ画面**: 音声エンジンのセットアップ方法や基本的なトラブルシューティングが記載されています。

## ⚠️ よくある問題と解決方法
- **音声が出ない**:
    - 「設定画面」で正しい音声出力デバイスが選択されているか確認してください。
    - 「デバッグ画面」で各音声エンジンの接続テストや音声テストを実行し、エラーが出ていないか確認してください。
    - ローカル音声エンジン (Avis Speech, VOICEVOX) を使用する場合、それぞれのエンジンが別途起動しているか、ポート番号が正しいか確認してください。
- **APIエラーが出る**:
    - 「設定画面」でAPIキーが正しく設定されているか確認してください。
    - インターネット接続を確認してください。
    - 各APIサービスの利用上限に達していないか確認してください。
- **特定のウィンドウが起動しない**:
    - コンソールにエラーメッセージが表示されていないか確認してください。
    - `requirements.txt` に記載されたライブラリが正しくインストールされているか確認してください。

詳細は各機能ウィンドウ内の表示や、「ヘルプ画面」を参照してください。

## 開発・カスタマイズ
- **設定ファイル**: `aituber_config_v22.json` にシステム設定やキャラクターデータが保存されます。
- **キャラクターテンプレート**: `character_manager.py` 内の `CharacterManager._load_templates()` で定義されています。
- **音声エンジン優先順位**: `audio_manager.py` 内の `VoiceEngineManager.__init__()` で `self.priority` として定義されています。
